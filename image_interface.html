<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI图像生成器 - 智谱CogView-4</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#6366f1',
                        'primary-dark': '#4f46e5',
                        'secondary': '#f1f5f9',
                        'accent': '#10b981',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen font-inter">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-r from-primary to-purple-600 p-3 rounded-xl">
                        <i class="fas fa-palette text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">AI图像生成器</h1>
                        <p class="text-sm text-gray-500">基于智谱CogView-4模型</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-accent/10 text-accent px-3 py-1 rounded-full text-sm font-medium">
                        <i class="fas fa-circle text-xs mr-1"></i>
                        在线服务
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Panel - Image Generation -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-primary to-purple-600 px-6 py-4">
                        <h2 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-magic mr-3"></i>
                            图像生成
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <form id="imageForm" class="space-y-6">
                            <!-- Prompt Input -->
                            <div>
                                <label for="prompt" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-pen-fancy mr-2 text-primary"></i>
                                    图像描述提示词
                                </label>
                                <textarea 
                                    id="prompt" 
                                    name="prompt" 
                                    rows="4" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent resize-none transition-all duration-200"
                                    placeholder="请详细描述您想要生成的图像，例如：一只可爱的柯基犬在樱花树下奔跑，阳光明媚，高清摄影风格"
                                    required
                                ></textarea>
                                <div class="mt-2 text-xs text-gray-500">
                                    <i class="fas fa-lightbulb mr-1"></i>
                                    提示：详细的描述能帮助生成更精确的图像
                                </div>
                            </div>

                            <!-- Model Selection -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="model" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-brain mr-2 text-primary"></i>
                                        生成模型
                                    </label>
                                    <select 
                                        id="model" 
                                        name="model" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                    >
                                        <option value="cogview-4">CogView-4 (推荐)</option>
                                        <option value="cogview-4-250304">CogView-4-250304</option>
                                        <option value="cogview-3-flash">CogView-3-Flash (快速)</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="size" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-expand-arrows-alt mr-2 text-primary"></i>
                                        图像尺寸
                                    </label>
                                    <select 
                                        id="size" 
                                        name="size" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                    >
                                        <option value="1024x1024">1024×1024 (正方形)</option>
                                        <option value="1024x768">1024×768 (横向)</option>
                                        <option value="768x1024">768×1024 (纵向)</option>
                                        <option value="768x768">768×768 (中等)</option>
                                        <option value="512x512">512×512 (小尺寸)</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="quality" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-gem mr-2 text-primary"></i>
                                        图像质量
                                    </label>
                                    <select 
                                        id="quality" 
                                        name="quality" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                                    >
                                        <option value="standard">标准质量</option>
                                        <option value="hd">高清质量</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Generate Button -->
                            <div class="flex justify-center">
                                <button 
                                    type="submit" 
                                    id="generateBtn"
                                    class="bg-gradient-to-r from-primary to-purple-600 hover:from-primary-dark hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center space-x-3"
                                >
                                    <i class="fas fa-magic text-lg"></i>
                                    <span>生成图像</span>
                                </button>
                            </div>
                        </form>

                        <!-- Loading State -->
                        <div id="loadingState" class="hidden text-center py-8">
                            <div class="inline-flex items-center space-x-3">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                                <span class="text-lg font-medium text-gray-700">正在生成图像...</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">这可能需要几秒钟时间</p>
                        </div>

                        <!-- Error State -->
                        <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-xl p-4 mt-6">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h3 class="text-sm font-medium text-red-800">生成失败</h3>
                                    <p id="errorMessage" class="text-sm text-red-600 mt-1"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generated Image Display -->
                <div id="imageResult" class="hidden bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden mt-8">
                    <div class="bg-gradient-to-r from-accent to-emerald-600 px-6 py-4">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-image mr-3"></i>
                            生成结果
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="text-center">
                            <img id="generatedImage" src="" alt="Generated Image" class="max-w-full h-auto rounded-xl shadow-lg mx-auto">
                            <div class="mt-4 flex justify-center space-x-4">
                                <a id="downloadBtn" href="" download class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center space-x-2">
                                    <i class="fas fa-download"></i>
                                    <span>下载图像</span>
                                </a>
                                <button id="shareBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center space-x-2">
                                    <i class="fas fa-share"></i>
                                    <span>分享</span>
                                </button>
                            </div>
                        </div>
                        <div id="imageInfo" class="mt-6 bg-gray-50 rounded-xl p-4">
                            <h4 class="font-medium text-gray-900 mb-2">图像信息</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">模型:</span>
                                    <span id="infoModel" class="ml-2 font-medium"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">尺寸:</span>
                                    <span id="infoSize" class="ml-2 font-medium"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">质量:</span>
                                    <span id="infoQuality" class="ml-2 font-medium"></span>
                                </div>
                                <div>
                                    <span class="text-gray-500">生成时间:</span>
                                    <span id="infoTime" class="ml-2 font-medium"></span>
                                </div>
                            </div>
                            <div class="mt-3">
                                <span class="text-gray-500">提示词:</span>
                                <p id="infoPrompt" class="mt-1 text-sm bg-white p-3 rounded-lg border"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - History & Settings -->
            <div class="space-y-6">
                <!-- Quick Examples -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <i class="fas fa-lightbulb mr-3"></i>
                            示例提示词
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-3">
                            <button class="example-prompt w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200 text-sm">
                                一只可爱的橘猫在阳光下打盹，毛发蓬松，表情安详
                            </button>
                            <button class="example-prompt w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200 text-sm">
                                未来科技城市夜景，霓虹灯闪烁，飞行汽车穿梭其中
                            </button>
                            <button class="example-prompt w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200 text-sm">
                                水彩画风格的山水画，远山如黛，近水含烟
                            </button>
                            <button class="example-prompt w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200 text-sm">
                                宇宙深处的星云，色彩绚烂，星光点点
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Generation History -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 px-6 py-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <i class="fas fa-history mr-3"></i>
                            生成历史
                        </h3>
                    </div>
                    <div class="p-6">
                        <div id="historyList" class="space-y-3">
                            <p class="text-gray-500 text-center py-4">暂无生成历史</p>
                        </div>
                    </div>
                </div>

                <!-- API Status -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-4">
                        <h3 class="text-lg font-semibold text-white flex items-center">
                            <i class="fas fa-server mr-3"></i>
                            API状态
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">连接状态</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="text-sm font-medium text-green-600">正常</span>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <button id="testApiBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors duration-200 text-sm">
                                <i class="fas fa-flask mr-2"></i>
                                测试API连接
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <p class="text-gray-500 text-sm">
                    © 2024 AI图像生成器 | 基于智谱CogView-4模型 | 
                    <a href="#" class="text-primary hover:text-primary-dark">使用说明</a>
                </p>
            </div>
        </div>
    </footer>

    <script>
        // DOM Elements
        const imageForm = document.getElementById('imageForm');
        const promptInput = document.getElementById('prompt');
        const generateBtn = document.getElementById('generateBtn');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const imageResult = document.getElementById('imageResult');
        const generatedImage = document.getElementById('generatedImage');
        const downloadBtn = document.getElementById('downloadBtn');
        const historyList = document.getElementById('historyList');
        const examplePrompts = document.querySelectorAll('.example-prompt');
        const testApiBtn = document.getElementById('testApiBtn');

        // Example prompt handlers
        examplePrompts.forEach(button => {
            button.addEventListener('click', () => {
                promptInput.value = button.textContent.trim();
                promptInput.focus();
            });
        });

        // Form submission
        imageForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(imageForm);
            const prompt = formData.get('prompt');
            const model = formData.get('model');
            const size = formData.get('size');
            const quality = formData.get('quality');

            // Show loading state
            showLoading();

            try {
                const response = await fetch('/generate-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt,
                        model,
                        size,
                        quality
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showImageResult(result);
                    addToHistory(result);
                } else {
                    showError(result.error || '生成失败，请重试');
                }
            } catch (error) {
                showError('网络错误，请检查连接后重试');
            }
        });

        // API test
        testApiBtn.addEventListener('click', async () => {
            testApiBtn.disabled = true;
            testApiBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>测试中...';

            try {
                const response = await fetch('/test-api', {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('API连接正常！');
                } else {
                    alert('API连接失败：' + result.error);
                }
            } catch (error) {
                alert('测试失败：' + error.message);
            } finally {
                testApiBtn.disabled = false;
                testApiBtn.innerHTML = '<i class="fas fa-flask mr-2"></i>测试API连接';
            }
        });

        // Helper functions
        function showLoading() {
            imageForm.style.display = 'none';
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            imageResult.classList.add('hidden');
        }

        function showError(message) {
            imageForm.style.display = 'block';
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            errorMessage.textContent = message;
            imageResult.classList.add('hidden');
        }

        function showImageResult(result) {
            imageForm.style.display = 'block';
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            imageResult.classList.remove('hidden');

            // Set image
            generatedImage.src = result.image_url || result.file_path;
            downloadBtn.href = result.image_url || result.file_path;

            // Set info
            document.getElementById('infoModel').textContent = result.model;
            document.getElementById('infoSize').textContent = result.size;
            document.getElementById('infoQuality').textContent = result.quality;
            document.getElementById('infoTime').textContent = new Date().toLocaleString();
            document.getElementById('infoPrompt').textContent = result.prompt;

            // Scroll to result
            imageResult.scrollIntoView({ behavior: 'smooth' });
        }

        function addToHistory(result) {
            const historyItem = document.createElement('div');
            historyItem.className = 'flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors duration-200';
            historyItem.innerHTML = `
                <img src="${result.image_url || result.file_path}" alt="Generated" class="w-12 h-12 rounded-lg object-cover">
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate">${result.prompt}</p>
                    <p class="text-xs text-gray-500">${result.model} • ${result.size}</p>
                </div>
            `;
            
            historyItem.addEventListener('click', () => {
                generatedImage.src = result.image_url || result.file_path;
                imageResult.classList.remove('hidden');
                imageResult.scrollIntoView({ behavior: 'smooth' });
            });

            if (historyList.children.length === 1 && historyList.children[0].textContent.includes('暂无生成历史')) {
                historyList.innerHTML = '';
            }
            
            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // Keep only last 5 items
            while (historyList.children.length > 5) {
                historyList.removeChild(historyList.lastChild);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            promptInput.focus();
        });
    </script>
</body>
</html>